<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Agendamento + Chat</title>
<style>
body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f4f4f4;
}
header {
    background: #0066cc;
    color: white;
    padding: 15px;
    text-align: center;
}
main {
    max-width: 800px;
    margin: 20px auto;
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
}
label { display: block; margin-top: 10px; font-weight: bold; }
input, select, button {
    padding: 8px;
    margin-top: 5px;
    width: 100%;
    box-sizing: border-box;
}
button {
    background: #0066cc;
    color: white;
    border: none;
    cursor: pointer;
    margin-top: 15px;
}
button:hover { background: #004c99; }
.horario {
    padding: 5px;
    border-bottom: 1px solid #ddd;
}
.ocupado { color: red; }
.disponivel { color: green; }
/* Chat lateral */
#chat {
    position: fixed;
    right: -350px;
    top: 0;
    width: 350px;
    height: 100%;
    background: #fff;
    border-left: 2px solid #0066cc;
    transition: right 0.3s;
    display: flex;
    flex-direction: column;
}
#chat header {
    background: #0066cc;
    color: white;
    padding: 10px;
    text-align: center;
    font-weight: bold;
}
#contacts {
    max-height: 150px;
    overflow-y: auto;
    border-bottom: 1px solid #ddd;
}
.contact {
    padding: 8px;
    cursor: pointer;
    border-bottom: 1px solid #f0f0f0;
}
.contact:hover {
    background: #f5f5f5;
}
#chatMessages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    background: #fafafa;
}
.message {
    margin-bottom: 10px;
    padding: 8px;
    border-radius: 8px;
    max-width: 70%;
    word-wrap: break-word;
}
.sent { background: #0066cc; color: white; margin-left: auto; }
.received { background: #e0e0e0; color: black; margin-right: auto; }
#chat input {
    width: calc(100% - 20px);
    margin: 10px;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ddd;
}
#toggleChat {
    position: fixed;
    right: 10px;
    bottom: 10px;
    background: #0066cc;
    color: white;
    padding: 10px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 18px;
}
</style>
</head>
<body>

<header><h1>Sistema de Agendamento</h1></header>

<main id="telaInicial">
    <h2>Bem-vindo!</h2>
    <button onclick="mostrarCadastro()">Cadastrar</button>
    <button onclick="mostrarLogin()">Entrar</button>
</main>

<main id="telaCadastro" style="display:none;">
    <h2>Cadastrar Professor</h2>
    <label>Nome:</label>
    <input type="text" id="novoNome">
    <button onclick="cadastrar()">Cadastrar</button>
    <button onclick="voltarInicio()">Voltar</button>
</main>

<main id="telaLogin" style="display:none;">
    <h2>Entrar</h2>
    <label>N√∫mero de Login:</label>
    <input type="number" id="loginNumero">
    <button onclick="entrar()">Entrar</button>
    <button onclick="voltarInicio()">Voltar</button>
</main>

<main id="telaAgendamento" style="display:none;">
    <h2>Agendamento de Salas</h2>
    <p id="usuarioLogado"></p>

    <label>Nome do Professor:</label>
    <input type="text" id="professor" readonly>

    <label>Mat√©ria:</label>
    <input type="text" id="materia">

    <label>Professor de curso t√©cnico?</label>
    <select id="tecnico">
        <option value="false">N√£o</option>
        <option value="true">Sim</option>
    </select>

    <label>Sala:</label>
    <select id="sala"></select>

    <label>Dia:</label>
    <select id="dia"></select>

    <label>Hor√°rio:</label>
    <select id="horario"></select>

    <button onclick="agendar()">Agendar</button>

    <div class="horarios" id="listaHorarios"></div>
</main>

<!-- CHAT -->
<div id="chat">
    <header>Chat de Professores</header>
    <div id="contacts"></div>
    <div id="chatHeader" style="padding:5px 10px; border-bottom:1px solid #ddd;">Selecione um professor</div>
    <div id="chatMessages"></div>
    <input type="text" id="chatInput" placeholder="Digite sua mensagem..." onkeypress="if(event.key==='Enter') sendMessage()">
</div>
<div id="toggleChat" onclick="toggleChat()">üí¨</div>

<script>
// ----------------- AGENDAMENTO -----------------
class Horario {
    constructor(professor, materia, tecnico) {
        this.professor = professor;
        this.materia = materia;
        this.tecnico = tecnico;
    }
    toString() {
        return `${this.professor} (${this.materia}) ${this.tecnico ? "[T√©cnico]" : ""}`;
    }
}
const salas = ["Laborat√≥rio de Inform√°tica","Laborat√≥rio de Ci√™ncias","Sala de V√≠deo","Audit√≥rio"];
const dias = ["Segunda","Ter√ßa","Quarta","Quinta","Sexta"];
const horarios = ["07:00","07:50","08:40","09:30","10:20","11:10","13:00","13:50","14:40","15:30","16:20","17:10","19:00","19:50","20:40","21:30","22:20"];
const agenda = {};
const professores = JSON.parse(localStorage.getItem("professores")) || [];
let usuario = null;
for (let d of dias) {
    agenda[d] = {};
    for (let s of salas) {
        agenda[d][s] = {};
        for (let h of horarios) {
            agenda[d][s][h] = null;
        }
    }
}
// ---- LOGIN / CADASTRO ----
function mostrarCadastro() {
    document.getElementById("telaInicial").style.display="none";
    document.getElementById("telaCadastro").style.display="block";
}
function mostrarLogin() {
    document.getElementById("telaInicial").style.display="none";
    document.getElementById("telaLogin").style.display="block";
}
function voltarInicio() {
    document.getElementById("telaCadastro").style.display="none";
    document.getElementById("telaLogin").style.display="none";
    document.getElementById("telaAgendamento").style.display="none";
    document.getElementById("telaInicial").style.display="block";
}
function cadastrar() {
    let nome = document.getElementById("novoNome").value.trim();
    if (!nome) { alert("Digite o nome!"); return; }
    let id = professores.length+1;
    professores.push({id, nome});
    localStorage.setItem("professores", JSON.stringify(professores));
    alert(`Cadastro realizado! Seu n√∫mero de login √© ${id}`);
    voltarInicio();
}
function entrar() {
    let id = parseInt(document.getElementById("loginNumero").value);
    let prof = professores.find(p => p.id===id);
    if (!prof) { alert("Login inv√°lido!"); return; }
    usuario = prof;
    document.getElementById("usuarioLogado").textContent = `Logado como: ${usuario.nome} (ID ${usuario.id})`;
    document.getElementById("professor").value = usuario.nome;
    document.getElementById("telaLogin").style.display="none";
    document.getElementById("telaAgendamento").style.display="block";
    carregarSelects();
    loadContacts(); // Atualiza lista de contatos do chat
}
// ---- AGENDAMENTO ----
function carregarSelects() {
    let salaSelect = document.getElementById("sala");
    let diaSelect = document.getElementById("dia");
    let horaSelect = document.getElementById("horario");
    if (salaSelect.options.length===0) salas.forEach(s => salaSelect.add(new Option(s,s)));
    if (diaSelect.options.length===0) dias.forEach(d => diaSelect.add(new Option(d,d)));
    if (horaSelect.options.length===0) horarios.forEach(h => horaSelect.add(new Option(h,h)));
    salaSelect.addEventListener("change", mostrarHorarios);
    diaSelect.addEventListener("change", mostrarHorarios);
    horaSelect.addEventListener("change", mostrarHorarios);
}
function mostrarHorarios() {
    let dia = document.getElementById("dia").value;
    let sala = document.getElementById("sala").value;
    let lista = document.getElementById("listaHorarios");
    lista.innerHTML="";
    if (!dia||!sala) return;
    for (let hora of horarios) {
        let h = agenda[dia][sala][hora];
        if (h) {
            let div=document.createElement("div");
            div.classList.add("horario","ocupado");
            div.textContent = `${hora} - Agendado por: ${h.toString()}`;
            lista.appendChild(div);
        }
    }
}
function agendar() {
    let materia = document.getElementById("materia").value.trim();
    let tecnico = document.getElementById("tecnico").value==="true";
    let sala = document.getElementById("sala").value;
    let dia = document.getElementById("dia").value;
    let hora = document.getElementById("horario").value;
    if (!materia||!sala||!dia||!hora) { alert("Preencha todos os campos!"); return; }
    let atual = agenda[dia][sala][hora];
    if (!atual || (!atual.tecnico && tecnico)) {
        agenda[dia][sala][hora]=new Horario(usuario.nome,materia,tecnico);
        alert("Agendado com sucesso!");
        mostrarHorarios();
    } else {
        alert("Hor√°rio j√° agendado!");
    }
}

// ----------------- CHAT -----------------
let currentChat = null;
function toggleChat() {
    let chat=document.getElementById("chat");
    chat.style.right = (chat.style.right==="0px"?"-350px":"0px");
}
function loadContacts() {
    let users = professores.filter(p => p.id!==usuario.id);
    const contactsDiv = document.getElementById("contacts");
    contactsDiv.innerHTML="";
    users.forEach(user=>{
        let div = document.createElement("div");
        div.className="contact";
        div.textContent = user.nome;
        div.onclick = ()=>openChat(user);
        contactsDiv.appendChild(div);
    });
}
function chatKey(user1, user2) {
    return "chat_"+[user1.id,user2.id].sort().join("_");
}
function openChat(user) {
    currentChat=user;
    document.getElementById("chatHeader").textContent = `Conversando com ${user.nome}`;
    loadMessages();
}
function loadMessages() {
    if(!currentChat) return;
    const key=chatKey(usuario,currentChat);
    let msgs = JSON.parse(localStorage.getItem(key)) || [];
    const msgDiv = document.getElementById("chatMessages");
    msgDiv.innerHTML="";
    msgs.forEach(m=>{
        let div=document.createElement("div");
        div.className="message "+(m.senderId===usuario.id?"sent":"received");
        div.textContent=m.text;
        msgDiv.appendChild(div);
    });
    msgDiv.scrollTop=msgDiv.scrollHeight;
}
function sendMessage() {
    if(!currentChat){ alert("Selecione um professor!"); return; }
    const input=document.getElementById("chatInput");
    const text=input.value.trim();
    if(!text) return;
    const key=chatKey(usuario,currentChat);
    let msgs = JSON.parse(localStorage.getItem(key)) || [];
    msgs.push({senderId:usuario.id,text});
    localStorage.setItem(key,JSON.stringify(msgs));
    input.value="";
    loadMessages();
}
</script>
</body>
</html>
